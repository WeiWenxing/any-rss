# Douyin1 æ¨¡å—

æŠ–éŸ³å†…å®¹è®¢é˜…æœåŠ¡æ¨¡å—ï¼Œæ”¯æŒä»æŠ–éŸ³ç”¨æˆ·ä¸»é¡µè·å–æœ€æ–°è§†é¢‘å†…å®¹ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… æ”¯æŒæŠ–éŸ³ç”¨æˆ·ä¸»é¡µé“¾æ¥è§£æ
- âœ… è‡ªåŠ¨å¤„ç†çŸ­é“¾æ¥é‡å®šå‘
- âœ… ä»URLä¸­æå–sec_user_id
- âœ… è°ƒç”¨ç¬¬ä¸‰æ–¹APIè·å–è§†é¢‘æ•°æ®
- âœ… è§£æè§†é¢‘è¯¦ç»†ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ã€ç»Ÿè®¡æ•°æ®ç­‰ï¼‰
- âœ… æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è¯·æ±‚
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## æ ¸å¿ƒç»„ä»¶

### DouyinFetcher (fetcher.py)

æŠ–éŸ³å†…å®¹è·å–å™¨ï¼Œè´Ÿè´£ï¼š
- URLè§£æå’Œé‡å®šå‘å¤„ç†
- APIè°ƒç”¨å’Œæ•°æ®è§£æ
- è§†é¢‘ä¿¡æ¯æå–
- ç¼“å­˜ç®¡ç†

### ContentManager (manager.py)

å†…å®¹ç®¡ç†å™¨ï¼Œè´Ÿè´£ï¼š
- è´¦å·è®¢é˜…ç®¡ç†
- å†…å®¹æ›´æ–°æ£€æŸ¥
- æ–°å†…å®¹è¿‡æ»¤
- ç»Ÿä¸€æ¶æ„é›†æˆ

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```python
from services.douyin1.fetcher import DouyinFetcher

# åˆ›å»ºè·å–å™¨å®ä¾‹
fetcher = DouyinFetcher()

# ä»æŠ–éŸ³URLè·å–ç”¨æˆ·å†…å®¹
douyin_url = "https://www.douyin.com/user/MS4wLjABAAAA4dOPs2xB33L5Sc8YUO2gFq9U6x5LXFkJ8v15AqeIgc8"
success, message, video_list = fetcher.fetch_user_content(douyin_url, count=10)

if success:
    print(f"æˆåŠŸè·å– {len(video_list)} ä¸ªè§†é¢‘")
    for video in video_list:
        print(f"è§†é¢‘ID: {video['aweme_id']}")
        print(f"æè¿°: {video['desc']}")
        print(f"æ’­æ”¾é‡: {video['statistics']['play_count']}")
else:
    print(f"è·å–å¤±è´¥: {message}")
```

### é«˜çº§ç”¨æ³•

```python
# åˆ†æ­¥å¤„ç†
fetcher = DouyinFetcher()

# 1. æå–sec_user_id
success, message, sec_user_id = fetcher.extract_sec_user_id(douyin_url)
if success:
    print(f"ç”¨æˆ·ID: {sec_user_id}")
    
    # 2. è·å–è§†é¢‘æ•°æ®
    success, message, api_data = fetcher.fetch_user_videos(sec_user_id, count=20)
    if success:
        print(f"è·å–åˆ°åŸå§‹APIæ•°æ®")

# 3. æ£€æŸ¥ç¼“å­˜çŠ¶æ€
is_cached = fetcher.is_cache_hit(douyin_url)
print(f"ç¼“å­˜å‘½ä¸­: {is_cached}")

# 4. æ¸…é™¤ç‰¹å®šURLçš„ç¼“å­˜
fetcher.clear_cache(douyin_url)
```

## æ”¯æŒçš„URLæ ¼å¼

- `https://www.douyin.com/user/MS4wLjABAAAA...`
- `https://v.douyin.com/çŸ­é“¾æ¥/`
- å…¶ä»–æŠ–éŸ³åŸŸåçš„ç”¨æˆ·ä¸»é¡µé“¾æ¥

## APIæ¥å£

ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹APIï¼š
- **æ¥å£åœ°å€**: `https://api.douyin.wtf/api/douyin/web/fetch_user_post_videos`
- **è¯·æ±‚å‚æ•°**: 
  - `sec_user_id`: ç”¨æˆ·ID
  - `max_cursor`: æ¸¸æ ‡ä½ç½®ï¼ˆåˆ†é¡µï¼‰
  - `count`: è·å–æ•°é‡

## ç¼“å­˜æœºåˆ¶

**å‚è€ƒsitemapæ¨¡å—çš„ç¼“å­˜ç­–ç•¥å®ç°**

- **ç¼“å­˜ç±»å‹**: æ–‡ä»¶ç¼“å­˜
- **ç¼“å­˜æ—¶é—´**: 1å°æ—¶ï¼ˆ3600ç§’ï¼‰
- **ç¼“å­˜é”®**: åŸºäºæŠ–éŸ³URLçš„MD5å“ˆå¸Œå€¼
- **ç¼“å­˜å€¼**: åŸå§‹APIæ•°æ®ï¼ˆä¸è¿›è¡Œåºåˆ—åŒ–å¤„ç†ï¼‰
- **ç¼“å­˜ç›®å½•**: `storage/cache/douyin1_api/`
- **ç¼“å­˜é…ç½®**: `use_json=False, decode_responses=False`

### ç¼“å­˜ç­–ç•¥ç‰¹ç‚¹

1. **åŸºäºURLçš„ç¼“å­˜é”®**: ä½¿ç”¨å®Œæ•´çš„æŠ–éŸ³URLä½œä¸ºç¼“å­˜é”®åŸºç¡€ï¼Œç¡®ä¿ä¸åŒURLæœ‰ç‹¬ç«‹çš„ç¼“å­˜
2. **åŸå§‹æ•°æ®å­˜å‚¨**: ç¼“å­˜å­˜å‚¨çš„æ˜¯APIè¿”å›çš„åŸå§‹JSONæ•°æ®ï¼Œä¸è¿›è¡Œä»»ä½•åºåˆ—åŒ–å¤„ç†
3. **é«˜æ•ˆè®¿é—®**: ç›¸åŒURLçš„é‡å¤è¯·æ±‚ç›´æ¥ä»ç¼“å­˜è·å–ï¼Œé¿å…é¢‘ç¹APIè°ƒç”¨
4. **æ™ºèƒ½ç®¡ç†**: æ”¯æŒå•ä¸ªURLç¼“å­˜æ¸…é™¤å’Œå…¨å±€ç¼“å­˜æ¸…é™¤

### ç¼“å­˜æ–¹æ³•

```python
# æ£€æŸ¥ç¼“å­˜å‘½ä¸­
is_hit = fetcher.is_cache_hit(douyin_url)

# æ¸…é™¤ç‰¹å®šURLç¼“å­˜
fetcher.clear_cache(douyin_url)

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
fetcher.clear_cache()

# è·å–ç¼“å­˜ä¿¡æ¯
cache_info = fetcher.get_cache_info()
```

## æ•°æ®ç»“æ„

### è§†é¢‘ä¿¡æ¯ç»“æ„

```python
{
    "aweme_id": "7504205454530268476",           # è§†é¢‘ID
    "desc": "#è®©æˆ‘æˆä¸ºä½ å¿ƒé‡Œçš„ä¸€æ ¹åˆºå§",              # è§†é¢‘æè¿°
    "caption": "#è®©æˆ‘æˆä¸ºä½ å¿ƒé‡Œçš„ä¸€æ ¹åˆºå§",           # è§†é¢‘æ ‡é¢˜
    "create_time": 1747208991,                   # åˆ›å»ºæ—¶é—´ï¼ˆUnixæ—¶é—´æˆ³ï¼‰
    "duration": 11400,                           # è§†é¢‘æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
    "aweme_type": 0,                            # è§†é¢‘ç±»å‹
    "is_top": 1,                                # æ˜¯å¦ç½®é¡¶
    
    "author": {                                 # ä½œè€…ä¿¡æ¯
        "uid": "92470219398",
        "nickname": "ç”¨æˆ·æ˜µç§°",
        "signature": "ç”¨æˆ·ç­¾å",
        "avatar_thumb": ["å¤´åƒURLåˆ—è¡¨"]
    },
    
    "statistics": {                             # ç»Ÿè®¡ä¿¡æ¯
        "play_count": 0,                        # æ’­æ”¾é‡
        "digg_count": 101264,                   # ç‚¹èµé‡
        "comment_count": 1207,                  # è¯„è®ºé‡
        "share_count": 0,                       # åˆ†äº«é‡
        "collect_count": 0                      # æ”¶è—é‡
    },
    
    "video": {                                  # è§†é¢‘ä¿¡æ¯
        "uri": "è§†é¢‘URI",
        "url_list": ["è§†é¢‘URLåˆ—è¡¨"],
        "width": 1080,                          # è§†é¢‘å®½åº¦
        "height": 1920,                         # è§†é¢‘é«˜åº¦
        "data_size": 4207811,                   # æ–‡ä»¶å¤§å°
        "file_hash": "æ–‡ä»¶å“ˆå¸Œ",
        "url_key": "URLå¯†é’¥"
    },
    
    "cover": {                                  # å°é¢ä¿¡æ¯
        "uri": "å°é¢URI",
        "url_list": ["å°é¢URLåˆ—è¡¨"]
    },
    
    "music": {                                  # éŸ³ä¹ä¿¡æ¯
        "id": "éŸ³ä¹ID",
        "title": "éŸ³ä¹æ ‡é¢˜",
        "author": "éŸ³ä¹ä½œè€…",
        "play_url": ["éŸ³ä¹æ’­æ”¾URLåˆ—è¡¨"]
    },
    
    "share_url": "åˆ†äº«é“¾æ¥"
}
```

## é”™è¯¯å¤„ç†

å¸¸è§é”™è¯¯ç±»å‹ï¼š
- URLæ ¼å¼é”™è¯¯
- ç½‘ç»œè¯·æ±‚å¤±è´¥
- APIè¿”å›é”™è¯¯
- æ•°æ®è§£æå¤±è´¥
- é‡å®šå‘å¤„ç†å¤±è´¥

æ‰€æœ‰é”™è¯¯éƒ½ä¼šè®°å½•è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬å †æ ˆè·Ÿè¸ªã€‚

## æ›´æ–°æ—¥å¿—

### v1.0.1 (2024-07-06)
- ğŸ”„ **ç¼“å­˜ç­–ç•¥é‡æ„**: å‚è€ƒsitemapæ¨¡å—å®ç°
- ğŸ”‘ **ç¼“å­˜é”®ä¼˜åŒ–**: ä½¿ç”¨æŠ–éŸ³URLä½œä¸ºç¼“å­˜é”®åŸºç¡€
- ğŸ’¾ **åŸå§‹æ•°æ®å­˜å‚¨**: ç¼“å­˜å­˜å‚¨åŸå§‹APIæ•°æ®ï¼Œä¸è¿›è¡Œåºåˆ—åŒ–
- ğŸš€ **æ€§èƒ½æå‡**: ä¼˜åŒ–ç¼“å­˜å‘½ä¸­ç‡å’Œè®¿é—®é€Ÿåº¦
- ğŸ› ï¸ **æ–¹æ³•å¢å¼º**: æ–°å¢`is_cache_hit()`æ–¹æ³•

### v1.0.0 (2024-07-06)
- ğŸ‰ **åˆå§‹ç‰ˆæœ¬**: åŸºç¡€åŠŸèƒ½å®ç°
- ğŸ” **URLè§£æ**: æ”¯æŒå¤šç§æŠ–éŸ³URLæ ¼å¼
- ğŸ“¡ **APIé›†æˆ**: é›†æˆç¬¬ä¸‰æ–¹æŠ–éŸ³API
- ğŸ¬ **è§†é¢‘è§£æ**: å®Œæ•´çš„è§†é¢‘ä¿¡æ¯æå–
- ğŸ’¾ **ç¼“å­˜æœºåˆ¶**: åŸºç¡€ç¼“å­˜åŠŸèƒ½

## æ³¨æ„äº‹é¡¹

1. **APIé™åˆ¶**: ç¬¬ä¸‰æ–¹APIå¯èƒ½æœ‰è®¿é—®é¢‘ç‡é™åˆ¶
2. **ç½‘ç»œä¾èµ–**: éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
3. **URLæ ¼å¼**: ç¡®ä¿æä¾›æ­£ç¡®çš„æŠ–éŸ³ç”¨æˆ·ä¸»é¡µé“¾æ¥
4. **æ•°æ®æ—¶æ•ˆ**: ç¼“å­˜æ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°çš„
5. **ç¼“å­˜ç®¡ç†**: å®šæœŸæ¸…ç†ç¼“å­˜ä»¥è·å–æœ€æ–°æ•°æ®

## å¼€å‘è€…ä¿¡æ¯

- **ä½œè€…**: Assistant
- **åˆ›å»ºæ—¶é—´**: 2024å¹´
- **ç‰ˆæœ¬**: 1.0.1
- **è®¸å¯**: é¡¹ç›®è®¸å¯è¯ 